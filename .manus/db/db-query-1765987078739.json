{
  "query": "\n-- User strategy subscriptions\nCREATE TABLE IF NOT EXISTS user_subscriptions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  strategyId INT NOT NULL,\n  notificationsEnabled BOOLEAN DEFAULT TRUE NOT NULL,\n  autoExecuteEnabled BOOLEAN DEFAULT FALSE NOT NULL,\n  quantityMultiplier DECIMAL(10, 4) DEFAULT 1.0000,\n  maxPositionSize INT,\n  subscribedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE KEY unique_user_strategy (userId, strategyId)\n);\n\n-- Subscription tiers (Stripe-ready)\nCREATE TABLE IF NOT EXISTS subscription_tiers (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(50) NOT NULL,\n  description TEXT,\n  priceMonthly INT NOT NULL,\n  priceYearly INT,\n  maxStrategies INT,\n  maxBrokerConnections INT,\n  autoExecuteAllowed BOOLEAN DEFAULT FALSE NOT NULL,\n  prioritySupport BOOLEAN DEFAULT FALSE NOT NULL,\n  stripeProductId VARCHAR(100),\n  stripePriceIdMonthly VARCHAR(100),\n  stripePriceIdYearly VARCHAR(100),\n  active BOOLEAN DEFAULT TRUE NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- User payment subscriptions (Stripe-ready)\nCREATE TABLE IF NOT EXISTS user_payment_subscriptions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL UNIQUE,\n  tierId INT NOT NULL,\n  status ENUM('active', 'past_due', 'cancelled', 'paused', 'trialing') DEFAULT 'active' NOT NULL,\n  billingCycle ENUM('monthly', 'yearly') DEFAULT 'monthly' NOT NULL,\n  currentPeriodStart DATETIME,\n  currentPeriodEnd DATETIME,\n  trialStart DATETIME,\n  trialEnd DATETIME,\n  stripeCustomerId VARCHAR(100),\n  stripeSubscriptionId VARCHAR(100),\n  cancelAtPeriodEnd BOOLEAN DEFAULT FALSE NOT NULL,\n  cancelledAt DATETIME,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Payment history (Stripe-ready)\nCREATE TABLE IF NOT EXISTS payment_history (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  subscriptionId INT,\n  amount INT NOT NULL,\n  currency VARCHAR(3) DEFAULT 'USD' NOT NULL,\n  status ENUM('pending', 'succeeded', 'failed', 'refunded') DEFAULT 'pending' NOT NULL,\n  stripePaymentIntentId VARCHAR(100),\n  stripeInvoiceId VARCHAR(100),\n  receiptUrl TEXT,\n  description TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Audit logs\nCREATE TABLE IF NOT EXISTS audit_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT,\n  action VARCHAR(100) NOT NULL,\n  resourceType VARCHAR(50),\n  resourceId INT,\n  ipAddress VARCHAR(45),\n  userAgent TEXT,\n  previousValue TEXT,\n  newValue TEXT,\n  status ENUM('success', 'failure') DEFAULT 'success' NOT NULL,\n  errorMessage TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_user_action (userId, action),\n  INDEX idx_created (createdAt)\n);\n\n-- Webhook queue\nCREATE TABLE IF NOT EXISTS webhook_queue (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  payload TEXT NOT NULL,\n  ipAddress VARCHAR(45),\n  status ENUM('pending', 'processing', 'completed', 'failed', 'dead') DEFAULT 'pending' NOT NULL,\n  attempts INT DEFAULT 0 NOT NULL,\n  maxAttempts INT DEFAULT 5 NOT NULL,\n  nextRetryAt DATETIME,\n  lastError TEXT,\n  webhookLogId INT,\n  receivedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  startedAt DATETIME,\n  completedAt DATETIME,\n  processingTimeMs INT,\n  correlationId VARCHAR(50),\n  INDEX idx_status (status),\n  INDEX idx_next_retry (nextRetryAt)\n);\n\n-- Dead letter queue\nCREATE TABLE IF NOT EXISTS dead_letter_queue (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  originalPayload TEXT NOT NULL,\n  ipAddress VARCHAR(45),\n  failureReason TEXT NOT NULL,\n  attempts INT NOT NULL,\n  lastAttemptAt DATETIME,\n  errorHistory TEXT,\n  status ENUM('unresolved', 'resolved', 'ignored') DEFAULT 'unresolved' NOT NULL,\n  resolvedBy INT,\n  resolvedAt DATETIME,\n  resolutionNotes TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_status (status)\n);\n\n-- User signals\nCREATE TABLE IF NOT EXISTS user_signals (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  webhookLogId INT NOT NULL,\n  strategyId INT NOT NULL,\n  direction VARCHAR(10) NOT NULL,\n  price INT NOT NULL,\n  quantity INT NOT NULL,\n  action ENUM('pending', 'executed', 'skipped', 'expired') DEFAULT 'pending' NOT NULL,\n  executionLogId INT,\n  signalReceivedAt DATETIME NOT NULL,\n  actionTakenAt DATETIME,\n  expiresAt DATETIME,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_user_strategy (userId, strategyId),\n  INDEX idx_action (action)\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2Wv7ueKqB8G6f57.b62a6ae065f5 --database jFmY8c2b9B6TEBRxmcJws8 --execute \n-- User strategy subscriptions\nCREATE TABLE IF NOT EXISTS user_subscriptions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  strategyId INT NOT NULL,\n  notificationsEnabled BOOLEAN DEFAULT TRUE NOT NULL,\n  autoExecuteEnabled BOOLEAN DEFAULT FALSE NOT NULL,\n  quantityMultiplier DECIMAL(10, 4) DEFAULT 1.0000,\n  maxPositionSize INT,\n  subscribedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE KEY unique_user_strategy (userId, strategyId)\n);\n\n-- Subscription tiers (Stripe-ready)\nCREATE TABLE IF NOT EXISTS subscription_tiers (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(50) NOT NULL,\n  description TEXT,\n  priceMonthly INT NOT NULL,\n  priceYearly INT,\n  maxStrategies INT,\n  maxBrokerConnections INT,\n  autoExecuteAllowed BOOLEAN DEFAULT FALSE NOT NULL,\n  prioritySupport BOOLEAN DEFAULT FALSE NOT NULL,\n  stripeProductId VARCHAR(100),\n  stripePriceIdMonthly VARCHAR(100),\n  stripePriceIdYearly VARCHAR(100),\n  active BOOLEAN DEFAULT TRUE NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- User payment subscriptions (Stripe-ready)\nCREATE TABLE IF NOT EXISTS user_payment_subscriptions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL UNIQUE,\n  tierId INT NOT NULL,\n  status ENUM('active', 'past_due', 'cancelled', 'paused', 'trialing') DEFAULT 'active' NOT NULL,\n  billingCycle ENUM('monthly', 'yearly') DEFAULT 'monthly' NOT NULL,\n  currentPeriodStart DATETIME,\n  currentPeriodEnd DATETIME,\n  trialStart DATETIME,\n  trialEnd DATETIME,\n  stripeCustomerId VARCHAR(100),\n  stripeSubscriptionId VARCHAR(100),\n  cancelAtPeriodEnd BOOLEAN DEFAULT FALSE NOT NULL,\n  cancelledAt DATETIME,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Payment history (Stripe-ready)\nCREATE TABLE IF NOT EXISTS payment_history (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  subscriptionId INT,\n  amount INT NOT NULL,\n  currency VARCHAR(3) DEFAULT 'USD' NOT NULL,\n  status ENUM('pending', 'succeeded', 'failed', 'refunded') DEFAULT 'pending' NOT NULL,\n  stripePaymentIntentId VARCHAR(100),\n  stripeInvoiceId VARCHAR(100),\n  receiptUrl TEXT,\n  description TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Audit logs\nCREATE TABLE IF NOT EXISTS audit_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT,\n  action VARCHAR(100) NOT NULL,\n  resourceType VARCHAR(50),\n  resourceId INT,\n  ipAddress VARCHAR(45),\n  userAgent TEXT,\n  previousValue TEXT,\n  newValue TEXT,\n  status ENUM('success', 'failure') DEFAULT 'success' NOT NULL,\n  errorMessage TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_user_action (userId, action),\n  INDEX idx_created (createdAt)\n);\n\n-- Webhook queue\nCREATE TABLE IF NOT EXISTS webhook_queue (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  payload TEXT NOT NULL,\n  ipAddress VARCHAR(45),\n  status ENUM('pending', 'processing', 'completed', 'failed', 'dead') DEFAULT 'pending' NOT NULL,\n  attempts INT DEFAULT 0 NOT NULL,\n  maxAttempts INT DEFAULT 5 NOT NULL,\n  nextRetryAt DATETIME,\n  lastError TEXT,\n  webhookLogId INT,\n  receivedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  startedAt DATETIME,\n  completedAt DATETIME,\n  processingTimeMs INT,\n  correlationId VARCHAR(50),\n  INDEX idx_status (status),\n  INDEX idx_next_retry (nextRetryAt)\n);\n\n-- Dead letter queue\nCREATE TABLE IF NOT EXISTS dead_letter_queue (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  originalPayload TEXT NOT NULL,\n  ipAddress VARCHAR(45),\n  failureReason TEXT NOT NULL,\n  attempts INT NOT NULL,\n  lastAttemptAt DATETIME,\n  errorHistory TEXT,\n  status ENUM('unresolved', 'resolved', 'ignored') DEFAULT 'unresolved' NOT NULL,\n  resolvedBy INT,\n  resolvedAt DATETIME,\n  resolutionNotes TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_status (status)\n);\n\n-- User signals\nCREATE TABLE IF NOT EXISTS user_signals (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  webhookLogId INT NOT NULL,\n  strategyId INT NOT NULL,\n  direction VARCHAR(10) NOT NULL,\n  price INT NOT NULL,\n  quantity INT NOT NULL,\n  action ENUM('pending', 'executed', 'skipped', 'expired') DEFAULT 'pending' NOT NULL,\n  executionLogId INT,\n  signalReceivedAt DATETIME NOT NULL,\n  actionTakenAt DATETIME,\n  expiresAt DATETIME,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_user_strategy (userId, strategyId),\n  INDEX idx_action (action)\n);\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 3143
}